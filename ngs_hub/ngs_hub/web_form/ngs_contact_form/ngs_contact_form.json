{
 "allow_comments": 0,
 "allow_delete": 0,
 "allow_edit": 0,
 "allow_incomplete": 0,
 "allow_multiple": 0,
 "allow_print": 0,
 "anonymous": 1,
 "apply_document_permissions": 0,
 "button_label": "Save",
 "client_script": "// \u8f7d\u5165 Turnstile\r\n(function injectTurnstile() {\r\n  if (document.getElementById('cf-turnstile-js')) return;\r\n  const s = document.createElement('script');\r\n  s.id = 'cf-turnstile-js';\r\n  s.src = 'https://challenges.cloudflare.com/turnstile/v0/api.js';\r\n  s.async = true; s.defer = true;\r\n  document.head.appendChild(s);\r\n})();\r\n\r\nfrappe.ready(() => {\r\n  const wrap = $(frappe.web_form.wrapper);\r\n\r\n  // \u4ece Single DocType \u6ce8\u5165\u7684 site key\uff08Jinja \u5728\u670d\u52a1\u5668\u7aef\u6e32\u67d3\uff09\r\n  const SITE_KEY = \"{{ frappe.db.get_single_value('NGS API KEY','turnstile_site_key') or '' }}\";\r\n  if (!SITE_KEY) {\r\n    console.warn('Turnstile site key not configured in NGS API KEY.');\r\n  }\r\n\r\n  // Turnstile \u5bb9\u5668\uff08\u9ed8\u8ba4 Managed \u6a21\u5f0f\uff1b\u8981\u4e0d\u53ef\u89c1\u5c31\u52a0 data-size=\"invisible\"\uff09\r\n  const box = document.createElement('div');\r\n  box.className = 'cf-turnstile';\r\n  if (SITE_KEY) box.setAttribute('data-sitekey', SITE_KEY);\r\n\r\n  // \u653e\u5728\u6309\u94ae\u4e0a\u65b9\r\n  wrap.find('.form-actions').before(box);\r\n\r\n  // \u63d0\u4ea4\u524d\u628a token \u5199\u5165\u9690\u85cf\u5b57\u6bb5\uff08fieldname \u5fc5\u987b\u662f turnstile_token\uff09\r\n  const orig_submit = frappe.web_form.submit;\r\n  frappe.web_form.submit = async function() {\r\n    const token = document.querySelector('input[name=\"cf-turnstile-response\"]')?.value;\r\n    if (!token) {\r\n      frappe.msgprint('\u8bf7\u5148\u5b8c\u6210\u9a8c\u8bc1\u7801');\r\n      return;\r\n    }\r\n    await frappe.web_form.set_value('turnstile_token', token);\r\n\r\n    const btn = wrap.find('.btn-primary');\r\n    btn.prop('disabled', true).text('\u63d0\u4ea4\u4e2d\u2026');\r\n    try {\r\n      await orig_submit.apply(frappe.web_form, arguments);\r\n    } finally {\r\n      btn.prop('disabled', false).text('Submit');\r\n      if (window.turnstile && box && SITE_KEY) {\r\n        turnstile.render(box, { sitekey: SITE_KEY });\r\n      }\r\n    }\r\n  };\r\n});\r\n",
 "condition_json": "[]",
 "creation": "2025-08-09 01:36:03.208083",
 "doc_type": "NGS Contact Form",
 "docstatus": 0,
 "doctype": "Web Form",
 "idx": 0,
 "is_standard": 1,
 "list_columns": [],
 "login_required": 0,
 "max_attachment_size": 0,
 "modified": "2025-08-09 01:51:20.170217",
 "modified_by": "Administrator",
 "module": "NGS Hub",
 "name": "ngs-contact-form",
 "owner": "Administrator",
 "published": 0,
 "route": "ngs-contact-form",
 "show_attachments": 0,
 "show_list": 0,
 "show_sidebar": 0,
 "title": "NGS Contact Form",
 "web_form_fields": [
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "full_name",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Full Name",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "email",
   "fieldtype": "Data",
   "hidden": 0,
   "label": "Email",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "message",
   "fieldtype": "Small Text",
   "hidden": 0,
   "label": "Message",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 1,
   "show_in_filter": 0
  },
  {
   "allow_read_on_all_link_options": 0,
   "fieldname": "turnstile_token",
   "fieldtype": "Data",
   "hidden": 1,
   "label": "Turnstile Token",
   "max_length": 0,
   "max_value": 0,
   "precision": "",
   "read_only": 0,
   "reqd": 0,
   "show_in_filter": 0
  }
 ]
}